var t=function(){function t(e){void 0===e&&(e=4),this.size=e,this.map=t.generateMap(e),this.listeners={}}return t.generateMap=function(t){for(var e=[],n=0;n<t;n++){e[n]=[];for(var r=0;r<t;r++)e[n][r]=0}return e},t.getRandomInt=function(t){return Math.floor(Math.random()*Math.floor(t))},t.rotateMap=function(t){for(var e=t,n=e.length,r=(n-1)/2,o=0;o<=r;o++)for(var i=o;i<n-1-o;i++){var a=e[o][i];e[o][i]=e[n-1-i][o],e[n-1-i][o]=e[n-1-o][n-1-i],e[n-1-o][n-1-i]=e[i][n-1-o],e[i][n-1-o]=a}return t},t.pleaseOutZero=function(t){for(var e=-1,n=0;n<t.length;n++){if(0!==t[n]&&-1!==e){var r=t[n];t[n]=t[e],t[e]=r,e+=1}-1===e&&0===t[n]&&(e=n)}return t},t.numPlus=function(t){for(var e=0,n=0;n<t.length;n++)e!==n&&0!==t[n]&&(t[e]===t[n]?(t[e]*=2,e=n+1,t[n]=0):e=n);return t},t.mergeOneLine=function(e){return t.pleaseOutZero(t.numPlus(e))},t.merge=function(e){for(var n=0;n<e.length;n++)t.mergeOneLine(e[n]);return e},t.generate2or4=function(){return 2*(t.getRandomInt(2)+1)},t.appendNum=function(e){for(var n=[],r=0;r<e.length;r++)for(var o=0;o<e.length;o++)0===e[r][o]&&n.push({i:r,j:o});if(!n.length)return!1;var i=n[t.getRandomInt(n.length)],a=i.i,p=i.j;return e[a][p]=t.generate2or4(),!0},t.dfsMap=function(t){var e=t.length,n=!0,r=function(o,i){if(!1!==n&&!(o>=e||i>=e)){if(o+1<e&&t[o][i]===t[o+1][i])return n=!1;if(i+1<e&&t[o][i]===t[o][i+1])return n=!1;r(o+1,i),r(o,i+1)}};return r(0,0),n},t.isOver=function(e){return t.dfsMap(e)},t.prototype.addEventListener=function(t,e){void 0===e&&(e=function(){}),this.listeners[t]=e},t.prototype.triggerListener=function(t){this.listeners[t]&&this.listeners[t]()},t.prototype.appendNumIntoMap=function(){!t.appendNum(this.map)&&t.isOver(this.map)&&this.autoRun()},t.prototype.autoRun=function(){var t=this;Object.keys(this.listeners).forEach((function(e){t.listeners[e]()}))},t.prototype.mergeMap=function(){t.merge(this.map),this.appendNumIntoMap()},t.prototype.getMap=function(){return this.map},t.prototype.init=function(){var e=t.getRandomInt(this.size),n=t.getRandomInt(this.size);return this.map[e][n]=2,{i:e,j:n}},t.prototype.start=function(){this.init()},t.prototype.restart=function(){this.clear(),this.init()},t.prototype.clear=function(){this.map=t.generateMap(this.size)},t.prototype.score=function(){for(var t=0,e=0;e<this.size;e++)for(var n=0;n<this.size;n++)t+=this.map[e][n];return t},t.prototype.rotate=function(e){for(void 0===e&&(e=1);e;)t.rotateMap(this.map),e--},t.prototype.leftMoving=function(){this.mergeMap()},t.prototype.rightMoving=function(){this.rotate(2),this.mergeMap(),this.rotate(2)},t.prototype.topMoving=function(){this.rotate(3),this.mergeMap(),this.rotate(1)},t.prototype.bottomMoving=function(){this.rotate(1),this.mergeMap(),this.rotate(3)},t}();export default t;
